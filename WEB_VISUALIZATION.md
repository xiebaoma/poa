# 🌐 Web可视化界面使用指南

## 🎯 快速启动

### 1️⃣ 安装依赖

```bash
pip install -r requirements.txt
```

主要依赖：
- `streamlit>=1.28.0` - Web界面框架
- `plotly>=5.17.0` - 交互式图表
- `pyspark>=3.5.0` - 数据处理引擎

### 2️⃣ 启动服务

**Mac/Linux:**
```bash
./visualization/run_web.sh
```

**Windows:**
```cmd
visualization\run_web.bat
```

**或使用Python直接启动:**
```bash
streamlit run visualization/app_streamlit.py
```

### 3️⃣ 访问界面

浏览器自动打开，或手动访问：
```
http://localhost:8501
```

---

## 📊 功能演示

### 界面布局

```
┌─────────────────────────────────────────────────────────┐
│                  舆情分析系统可视化平台                  │
├──────────────┬──────────────────────────────────────────┤
│              │  ┌────────────────────────────────────┐  │
│  侧边栏配置   │  │         主内容区域                │  │
│              │  │  ┌─────────────────────────────┐  │  │
│ ⚙️ 系统配置   │  │  │  📋 数据概览                │  │  │
│              │  │  ├─────────────────────────────┤  │  │
│ 1️⃣ 数据源    │  │  │  😊 情感分析                │  │  │
│ ○ 生成模拟数据│  │  ├─────────────────────────────┤  │  │
│ ○ 加载已有数据│  │  │  🔥 热点话题                │  │  │
│              │  │  ├─────────────────────────────┤  │  │
│ 2️⃣ 分析参数   │  │  │  📈 趋势分析                │  │  │
│ Top-N: 20    │  │  └─────────────────────────────┘  │  │
│ 时间窗口: day │  │                                    │  │
│              │  └────────────────────────────────────┘  │
│ 🚀 运行分析   │                                          │
│ 🗑️ 清除结果   │                                          │
└──────────────┴──────────────────────────────────────────┘
```

### 使用流程

```
开始
  ↓
配置参数 (左侧边栏)
  ├─ 选择数据源 (生成/加载)
  ├─ 设置生成参数/文件路径
  └─ 配置分析参数
  ↓
点击「运行分析」
  ↓
系统处理 (显示进度)
  ├─ 初始化系统 (10%)
  ├─ 加载数据 (20%)
  ├─ ETL预处理 (40%)
  ├─ 情感分析 (60%)
  ├─ 话题挖掘 (75%)
  └─ 趋势分析 (90%)
  ↓
查看结果 (标签页切换)
  ├─ 📋 数据概览
  ├─ 😊 情感分析  
  ├─ 🔥 热点话题
  └─ 📈 趋势分析
  ↓
结束 (可清除结果重新分析)
```

---

## 🎨 界面功能详解

### 📋 数据概览标签

**统计卡片:**
- 总记录数
- 正面情绪数量及比例
- 中性情绪数量及比例
- 负面情绪数量及比例

**数据表格:**
- 展示原始数据样本（最多1000条）
- 包含字段：doc_id, content, source, timestamp, sentiment_label, sentiment_score

---

### 😊 情感分析标签

**情感分布可视化:**

1. **饼图** (左侧)
   - 显示正面/中性/负面比例
   - 百分比标注
   - 颜色编码：
     - 绿色 🟢 = 正面
     - 灰色 ⚪ = 中性
     - 红色 🔴 = 负面

2. **柱状图** (右侧)
   - 各情感类别数量统计
   - 数值标注

3. **各来源情感分布**
   - 分组柱状图
   - 对比不同数据来源的情感倾向

---

### 🔥 热点话题标签

**1. 高频词 Top-N** (左侧)
- 横向柱状图
- 按频次降序排列
- 蓝色渐变配色
- 最多显示20个词汇

**2. TF-IDF 关键词** (右侧)
- 横向柱状图
- 按TF-IDF分数排序
- 橙色渐变配色
- 反映词汇重要性

**3. 趋势上升词汇** (底部)
- 树状图展示
- 面积 = 近期频次
- 颜色 = 增长率
  - 绿色 = 高增长
  - 黄色 = 中等增长
  - 红色 = 低增长

---

### 📈 趋势分析标签

**1. 情感随时间变化趋势**
- 多线折线图
- 三条线分别代表：
  - 绿线 🟢 = 正面情绪
  - 灰线 ⚪ = 中性情绪
  - 红线 🔴 = 负面情绪
- 支持悬停查看详细数据

**2. 负面情绪比例变化**
- 面积图
- 红色虚线标注预警阈值 (40%)
- 纵轴显示百分比

**3. 负面舆情预警**
- 自动识别超过阈值的时间点
- 黄色警告卡片显示：
  - 预警时间
  - 负面数量
  - 负面比例
  - 总数据量

---

## ⚙️ 参数配置说明

### 数据源配置

#### 选项1: 生成模拟数据
```
├─ 生成记录数: 100 - 10,000 (滑块)
└─ 日期范围: 自定义起止日期
```

**适用场景:**
- 演示测试
- 功能验证
- 无真实数据时

#### 选项2: 加载已有数据
```
├─ 数据路径: data/raw (默认)
└─ 文件格式: csv/json/parquet
```

**数据格式要求:**
```csv
doc_id,content,source,timestamp
1,"这是一条评论",微博,2025-12-01 10:00:00
```

必需字段：
- `content`: 文本内容
- `timestamp`: 时间戳

可选字段：
- `doc_id`: 文档ID
- `source`: 数据来源

### 分析参数配置

**Top-N 关键词数量**
- 范围: 5 - 50
- 默认: 20
- 说明: 展示的热点关键词数量

**时间窗口**
- hour: 按小时聚合
- day: 按天聚合 (默认)
- week: 按周聚合
- month: 按月聚合

---

## 💡 使用技巧

### 1. 快速入门
```bash
# 1. 使用默认配置生成1000条数据
# 2. 点击「运行分析」
# 3. 等待约30秒完成
# 4. 切换标签页查看结果
```

### 2. 分析真实数据
```bash
# 1. 准备CSV文件 (包含content和timestamp列)
# 2. 放置到 data/raw 目录
# 3. 选择「加载已有数据」
# 4. 输入路径或使用默认路径
# 5. 运行分析
```

### 3. 调整分析粒度
```bash
# 查看小时级趋势
时间窗口 → hour

# 查看长期趋势
时间窗口 → week 或 month
```

### 4. 重新分析
```bash
# 点击左侧边栏「清除结果」按钮
# 修改参数后重新运行
```

---

## 🎬 演示场景

### 场景1: 产品舆情监控

**目标:** 分析某产品发布后一个月的用户反馈

**操作步骤:**
1. 选择「生成模拟数据」
2. 设置记录数: 5000
3. 日期范围: 最近30天
4. Top-N: 30
5. 时间窗口: day
6. 运行分析

**关注指标:**
- 情感分析：正面比例是否 > 60%
- 趋势分析：负面情绪是否有激增
- 热点话题：用户主要讨论哪些功能

---

### 场景2: 突发事件分析

**目标:** 快速了解某事件的舆情态势

**操作步骤:**
1. 加载相关数据文件
2. 时间窗口: hour (细粒度)
3. Top-N: 50 (更多关键词)
4. 运行分析

**关注指标:**
- 数据概览：样本内容是否相关
- 热点话题：主要讨论点
- 趋势分析：是否触发预警

---

### 场景3: 多平台对比

**目标:** 对比不同平台的情感差异

**操作步骤:**
1. 确保数据包含source字段
2. 运行分析
3. 查看「各来源情感分布」图表

**分析维度:**
- 各平台正负面比例
- 不同平台讨论重点
- 平台间趋势差异

---

## 🔧 故障排查

### 问题1: 启动失败

**症状:**
```
ModuleNotFoundError: No module named 'streamlit'
```

**解决:**
```bash
pip install streamlit plotly
```

---

### 问题2: 分析卡住

**症状:**
- 进度条停在某个位置不动
- 长时间无响应

**原因:**
- 数据量过大
- 内存不足
- Spark配置过小

**解决:**
```yaml
# 编辑 src/main/resources/config/config.yaml
spark:
  executor_memory: "4g"  # 增加到4G
  driver_memory: "2g"    # 增加到2G
```

或减少数据量：
```python
# 生成记录数设置为 500-1000
```

---

### 问题3: 图表显示异常

**症状:**
- 图表空白
- 数据错位
- 样式混乱

**解决:**
1. 刷新浏览器页面 (F5)
2. 清除浏览器缓存 (Ctrl+Shift+Delete)
3. 尝试其他浏览器 (Chrome推荐)
4. 点击「清除结果」重新分析

---

### 问题4: 端口被占用

**症状:**
```
OSError: [Errno 48] Address already in use
```

**解决:**
```bash
# 方法1: 杀掉占用8501端口的进程
lsof -ti:8501 | xargs kill -9

# 方法2: 使用其他端口
streamlit run visualization/app_streamlit.py --server.port=8502
```

---

## 📚 扩展阅读

### 相关文档
- [README.md](README.md) - 项目总览
- [ENVIRONMENT_SETUP.md](ENVIRONMENT_SETUP.md) - 环境配置
- [visualization/README.md](visualization/README.md) - 可视化详细文档

### 技术文档
- [Streamlit官方文档](https://docs.streamlit.io)
- [Plotly图表库](https://plotly.com/python/)
- [PySpark文档](https://spark.apache.org/docs/latest/api/python/)

### 数据源推荐
- [微博开放平台](https://open.weibo.com/)
- [GitHub公开数据集](https://github.com/search?q=sentiment+analysis+dataset)
- [Kaggle数据集](https://www.kaggle.com/datasets)

---

## 🤝 贡献与反馈

如发现问题或有改进建议，欢迎：
- 提交Issue
- 发起Pull Request
- 联系开发团队

---

**享受舆情分析之旅！** 📊✨

